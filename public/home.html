<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="/socket.io/socket.io.js"></script>
    <script src="https://code.jquery.com/jquery-1.11.1.js"></script>
    <link rel="stylesheet" href="http://cdn.bootcss.com/bootstrap/3.3.0/css/bootstrap.min.css">
    <script>
        let socket = io();

        function sendMessage() {
            socket.emit('chat', $('#m').val());
            $('#m').val('');
        }
        function changeFiles(e) {
            var e = e || window.event;
            var files = e.target.files || e.dataTransfer.files;
            var len = files.length;
            if (len === 0) return false;
            for (var i = 0; i < len; i++) {
                var fs = new FileReader();
                fs.readAsDataURL(files[i]);
                fs.onload = function () {
                    socket.emit('send img', this.result);
                }
            }
        }
        socket.on('chat message', function (msg) {
            $('#messages').append($('<li>').text(msg));
        });
        socket.on('receive img', (msg)=> {
            let html = '<img src="' + msg + '">';
            $('#messages').append($('<li>').html(html));
        });
        /*$(function () {
         $('#addImage').on('click', function (e) {
         let e = e || window.event;
         e.stopPropagation();
         $('#files').trigger('click');
         });
         });*/
    </script>
</head>
<body>

<div class="panel panel-default col-md-8 col-md-offset-4">
    <div class="panel-heading">
        聊天内容
    </div>
    <div class="panel-body">
        <ul id="messages"></ul>

        <div class="input-group" id="input">
            <input type="file" accept="image/*" id="files" class="form-control" onchange="changeFiles(event)">
            <input id="m" class="form-control"/>
            <button class="btn btn-success" onclick="sendMessage()">Send</button>
        </div>
    </div>
</div>
</body>
</html>